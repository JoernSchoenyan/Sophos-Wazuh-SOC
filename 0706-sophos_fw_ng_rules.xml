<!--
  -  Sophos "Standard syslog protocol" or "Central Reporting Format" rules for Wazuh
  -  Created by Jörn Schönyan
  -  Reference used: https://docs.sophos.com/nsg/sophos-firewall/20.0/pdf/sf-syslog-guide-20.0.pdf
  -  This program is a free software; you can redistribute it and/or modify it under the terms of GPLv2.
-->

<group name="sophos_fw_ng">
    <rule id="113800" level="0">
        <decoded_as>sophos-fw-ng</decoded_as>
        <description>Sophos Firewall event</description>
    </rule>

    <!-- 01+ - general firewall events -->
    <rule id="113801" level="5">
        <if_sid>113800</if_sid>
        <field name="log_type">Firewall</field>
        <field name="log_subtype">Denied</field>
        <description>Traffic Denied: from $(srcip) to $(dstip)</description>
    </rule>

    <rule id="113802" level="3">
        <if_sid>113800</if_sid>
        <field name="log_type">Firewall</field>
        <field name="log_subtype">Allowed</field>
        <description>Traffic Allowed: from $(srcip) to $(dstip)</description>
    </rule>
    
    <rule id="113803" level="5">
        <if_sid>113800</if_sid>
        <field name="log_type">Firewall</field>
        <field name="log_subtype">Drop</field>
        <description>Connection dropped from $(srcip) to $(dstip)</description>
    </rule>

    <!-- 10+ - ATP events -->
    <rule id="113810" level="5">
        <if_sid>113800</if_sid>
        <field name="log_type">ATP</field>
        <field name="log_subtype">Drop</field>
        <description>ATP dropped a connection from $(srcip) to $(dstip)</description>
		<mitre>
			<id>T1203</id>
		</mitre>
    </rule>
    
    <rule id="113811" level="5">
        <if_sid>113800</if_sid>
        <field name="log_type">ATP</field>
        <field name="log_subtype">Alert</field>
        <description>ATP raised an alert, connection from $(srcip) to $(dstip)</description>
		<mitre>
			<id>T1203</id>
		</mitre>
    </rule>    
    
    <!-- 20+ - Firewall authentication events -->
    <rule id="113820" level="5">
        <if_sid>113800</if_sid>
        <field name="log_subtype">Authentication</field>
        <field name="log_component">Firewall Authentication</field>
        <description>$(message)</description>
		<mitre>
			<id>T1078</id>
		</mitre>
    </rule>

    <!-- this can be SSH or a local console -->
    <rule id="113821" level="5">
        <if_sid>113800</if_sid>
        <field name="log_component">CLI</field>
        <description>$(message)</description>
    </rule>
	
	<rule id="113822" level="8" frequency="5" timeframe="5">
        <if_matched_sid>113821</if_matched_sid>
        <description>There may be a bruteforce attack ongoing</description>
		<mitre>
			<id>T1110</id>
		</mitre>
    </rule>

    <!-- 40+ - misc events -->
    <rule id="113840" level="3">
        <if_sid>113800</if_sid>
        <field name="log_component">DDNS</field>
        <description>$(message)</description>
    </rule>

    <rule id="113841" level="3">
        <if_sid>113800</if_sid>
        <field name="log_component">DHCP</field>
        <description>$(message)</description>
    </rule>
	
	<rule id="113842" level="3">
        <if_sid>113800</if_sid>
        <field name="log_component">Gateway</field>
        <description>$(message)</description>
    </rule>
	
	<rule id="113843" level="3">
        <if_sid>113800</if_sid>
        <field name="log_component">HA</field>
		<field name="severity">Notification</field>
        <description>HA status changed</description>
    </rule>
	
	<rule id="113844" level="5">
        <if_sid>113800</if_sid>
        <field name="log_component">HA</field>
		<field name="severity">Warning</field>
        <description>HA has a warning</description>
    </rule>
	
	<rule id="113845" level="3">
        <if_sid>113800</if_sid>
		<field name="log_component">Interface</field>
		<field name="log_type">System Health</field>
		<field name="log_subtype">Usage</field>
        <description>FW reported interface usage for $(interface)</description>
    </rule>
    
    <rule id="113846" level="3">
        <if_sid>113800</if_sid>
		<field name="log_component">CPU</field>
		<field name="log_type">System Health</field>
		<field name="log_subtype">Usage</field>
        <description>FW reported CPU usage</description>
    </rule>
    
    <rule id="113847" level="3">
        <if_sid>113800</if_sid>
		<field name="log_component">Memory</field>
		<field name="log_type">System Health</field>
		<field name="log_subtype">Usage</field>
        <description>FW reported RAM usage</description>
    </rule>
    
    <rule id="113848" level="3">
        <if_sid>113800</if_sid>
		<field name="log_component">Live User</field>
		<field name="log_type">System Health</field>
		<field name="log_subtype">Usage</field>
        <description>FW reported active user count</description>
    </rule>
    
    <rule id="113849" level="3">
        <if_sid>113800</if_sid>
		<field name="log_component">SSL</field>
		<field name="log_type">System Health</field>
		<field name="log_subtype">Usage</field>
        <description>FW reported stats about SSL encryption</description>
    </rule>
    
    <rule id="113850" level="3">
        <if_sid>113800</if_sid>
		<field name="log_component">Disk</field>
		<field name="log_type">System Health</field>
		<field name="log_subtype">Usage</field>
        <description>FW reported disk space usage</description>
    </rule>

    <!-- 60+ - Mail events -->
    <rule id="113860" level="5">
        <if_sid>113800</if_sid>
        <field name="log_component">SMTP|SMTPS|IMAP4|IMAPS|POP3|POPS</field>
        <field name="antispam_action">Quarantine</field>
        <description>Mail in quarantine</description>
		<mitre>
			<id>T1566</id>
		</mitre>
    </rule>
	
	<rule id="113861" level="5">
        <if_sid>113800</if_sid>
        <field name="log_component">SMTP|SMTPS|IMAP4|IMAPS|POP3|POPS</field>
        <field name="antispam_action">Drop</field>
        <description>Mail dropped: $(reason)</description>
    </rule>
	
	<rule id="113862" level="5">
        <if_sid>113800</if_sid>
        <field name="log_component">SMTP|SMTPS|IMAP4|IMAPS|POP3|POPS</field>
        <field name="antispam_action">Reject</field>
        <description>Mail rejected: $(reason)</description>
    </rule>
	
	<rule id="113863" level="5">
        <if_sid>113800</if_sid>
        <field name="log_component">SMTP|SMTPS|IMAP4|IMAPS|POP3|POPS</field>
        <field name="antispam_action">Tmpreject</field>
        <description>Mail tmp-rejected: $(reason)</description>
    </rule>
	
	<rule id="113864" level="3">
        <if_sid>113800</if_sid>
        <field name="log_component">SMTP|SMTPS|IMAP4|IMAPS|POP3|POPS</field>
        <field name="antispam_action">Accept</field>
        <description>Mail accepted</description>
    </rule>
	
	<!-- 70+ - Heartbeats -->
	<rule id="113870" level="3">
        <if_sid>113800</if_sid>
        <field name="log_type">Heartbeat</field>
		<field name="log_component">Endpoint</field>
        <description>$(ep_name) changed Heartbeat status to $(ep_health)</description>
    </rule>
	
	<rule id="113871" level="3">
        <if_sid>113800</if_sid>
        <field name="log_type">Heartbeat</field>
		<field name="log_component">Heartbeat</field>
        <description>Heartbeat status of $(total) endpoints reported</description>
    </rule>
	
	<!-- 80+ - IPS/IDS -->
	<rule id="113880" level="8">
        <if_sid>113800</if_sid>
        <field name="log_type">IDP</field>
		<field name="log_subtype">Drop</field>
        <description>IPS dropped a connection</description>
    </rule>
	
	<rule id="113881" level="8">
        <if_sid>113800</if_sid>
        <field name="log_type">IDP</field>
		<field name="log_subtype">Detect</field>
		<field name="log_component">Anomaly</field>
        <description>IPS detected a connection with an anomaly</description>
    </rule>
	
	<rule id="113882" level="8">
        <if_sid>113800</if_sid>
        <field name="log_type">IDP</field>
		<field name="log_subtype">Detect</field>
		<field name="log_component">Signatures</field>
        <description>IPS detected a connection with a known signature</description>
    </rule>
    
    <!-- 90+ - VPN -->
	<rule id="113890" level="5">
        <if_sid>113800</if_sid>
        <field name="log_component">IPSec</field>
        <description>IPSec VPN event: $(sophos_fw_status)</description>
    </rule>
    
    <rule id="113891" level="5">
        <if_sid>113800</if_sid>
        <field name="log_component">L2TP</field>
        <description>L2TP VPN event: $(sophos_fw_status)</description>
    </rule>
    
    <rule id="113892" level="5">
        <if_sid>113800</if_sid>
        <field name="log_component">PPTP</field>
        <description>PPTP VPN event: $(sophos_fw_status)</description>
    </rule>
    
    <rule id="113893" level="5">
        <if_sid>113800</if_sid>
        <field name="log_component">RED</field>
        <description>RED VPN event: $(sophos_fw_status)</description>
    </rule>
</group>
